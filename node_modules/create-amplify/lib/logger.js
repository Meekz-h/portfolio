import yargs from 'yargs';
import * as os from 'os';
/**
 * A logger that logs messages to the console.
 */
export class Logger {
    minimumLogLevel;
    stdout;
    // Properties for ellipsis animation
    timer;
    refreshRate;
    timerSet;
    /**
     * Creates a new Logger instance. Injecting stdout for testing.
     * @param minimumLogLevel The minimum log level to log.
     * @param stdout The stream to write logs to. Injected for testing.
     */
    constructor(minimumLogLevel = LogLevel.INFO, stdout = process.stdout) {
        this.minimumLogLevel = minimumLogLevel;
        this.stdout = stdout;
        this.refreshRate = 500; // every 0.5 seconds
    }
    /**
     * Logs a message to the console.
     */
    log(message, level = LogLevel.INFO) {
        const toLogMessage = level <= this.minimumLogLevel;
        if (!toLogMessage) {
            return;
        }
        const logMessage = this.minimumLogLevel === LogLevel.DEBUG
            ? `[${LogLevel[level]}] ${new Date().toISOString()}: ${message}`
            : message;
        this.stdout.write(logMessage + os.EOL);
    }
    /**
     * Logs a message with animated ellipsis
     */
    async indicateProgress(message, callback) {
        try {
            this.startAnimatingEllipsis(message);
            await callback();
        }
        finally {
            this.stopAnimatingEllipsis(message);
        }
    }
    /**
     * Writes escape sequence to stdout
     */
    writeEscapeSequence(action) {
        if (!this.isTTY()) {
            return;
        }
        this.stdout.write(action);
    }
    /**
     * Checks if the environment is TTY
     */
    isTTY() {
        return this.stdout.isTTY;
    }
    /**
     * Logs an error to the console.
     */
    error(message) {
        this.log(message, LogLevel.ERROR);
    }
    /**
     * Logs a warning to the console.
     */
    warn(message) {
        this.log(message, LogLevel.WARNING);
    }
    /**
     * Logs an info message to the console.
     */
    info(message) {
        this.log(message, LogLevel.INFO);
    }
    /**
     * Logs a debug message to the console.
     */
    debug(message) {
        this.log(message, LogLevel.DEBUG);
    }
    /**
     * Start animating ellipsis at the end of a log message.
     */
    startAnimatingEllipsis(message) {
        if (!this.isTTY()) {
            this.log(message, LogLevel.INFO);
            return;
        }
        if (this.timerSet) {
            throw new Error('Timer is already set to animate ellipsis, stop the current running timer before starting a new one.');
        }
        const frameLength = 4; // number of desired dots - 1
        let frameCount = 0;
        this.timerSet = true;
        this.writeEscapeSequence(EscapeSequence.HIDE_CURSOR);
        this.stdout.write(message);
        this.timer = setInterval(() => {
            this.writeEscapeSequence(EscapeSequence.CLEAR_LINE);
            this.writeEscapeSequence(EscapeSequence.MOVE_CURSOR_TO_START);
            this.stdout.write(message + '.'.repeat(++frameCount % frameLength));
        }, this.refreshRate);
    }
    /**
     * Stops animating ellipsis and replace with a log message.
     */
    stopAnimatingEllipsis(message) {
        if (!this.isTTY()) {
            return;
        }
        clearInterval(this.timer);
        this.timerSet = false;
        this.writeEscapeSequence(EscapeSequence.CLEAR_LINE);
        this.writeEscapeSequence(EscapeSequence.MOVE_CURSOR_TO_START);
        this.writeEscapeSequence(EscapeSequence.SHOW_CURSOR);
        this.stdout.write(`${message}...${os.EOL}`);
    }
}
var EscapeSequence;
(function (EscapeSequence) {
    EscapeSequence["CLEAR_LINE"] = "\u001B[2K";
    EscapeSequence["MOVE_CURSOR_TO_START"] = "\u001B[0G";
    EscapeSequence["SHOW_CURSOR"] = "\u001B[?25h";
    EscapeSequence["HIDE_CURSOR"] = "\u001B[?25l";
})(EscapeSequence || (EscapeSequence = {}));
export var LogLevel;
(function (LogLevel) {
    LogLevel[LogLevel["ERROR"] = 0] = "ERROR";
    LogLevel[LogLevel["WARNING"] = 1] = "WARNING";
    LogLevel[LogLevel["INFO"] = 2] = "INFO";
    LogLevel[LogLevel["DEBUG"] = 3] = "DEBUG";
})(LogLevel || (LogLevel = {}));
export const argv = await yargs(process.argv.slice(2)).options({
    debug: {
        type: 'boolean',
        default: false,
    },
}).argv;
const minimumLogLevel = argv.debug ? LogLevel.DEBUG : LogLevel.INFO;
const logger = new Logger(minimumLogLevel, process.stdout);
export { logger };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9nZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2xvZ2dlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDMUIsT0FBTyxLQUFLLEVBQUUsTUFBTSxJQUFJLENBQUM7QUFFekI7O0dBRUc7QUFDSCxNQUFNLE9BQU8sTUFBTTtJQVlFO0lBQ0E7SUFabkIsb0NBQW9DO0lBQzVCLEtBQUssQ0FBZ0M7SUFDckMsV0FBVyxDQUFTO0lBQ3BCLFFBQVEsQ0FBVTtJQUUxQjs7OztPQUlHO0lBQ0gsWUFDbUIsa0JBQTRCLFFBQVEsQ0FBQyxJQUFJLEVBQ3pDLFNBQVMsT0FBTyxDQUFDLE1BQU07UUFEdkIsb0JBQWUsR0FBZixlQUFlLENBQTBCO1FBQ3pDLFdBQU0sR0FBTixNQUFNLENBQWlCO1FBRXhDLElBQUksQ0FBQyxXQUFXLEdBQUcsR0FBRyxDQUFDLENBQUMsb0JBQW9CO0lBQzlDLENBQUM7SUFFRDs7T0FFRztJQUNILEdBQUcsQ0FBQyxPQUFlLEVBQUUsUUFBa0IsUUFBUSxDQUFDLElBQUk7UUFDbEQsTUFBTSxZQUFZLEdBQUcsS0FBSyxJQUFJLElBQUksQ0FBQyxlQUFlLENBQUM7UUFFbkQsSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNqQixPQUFPO1NBQ1I7UUFFRCxNQUFNLFVBQVUsR0FDZCxJQUFJLENBQUMsZUFBZSxLQUFLLFFBQVEsQ0FBQyxLQUFLO1lBQ3JDLENBQUMsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBSyxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxLQUFLLE9BQU8sRUFBRTtZQUNoRSxDQUFDLENBQUMsT0FBTyxDQUFDO1FBQ2QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsZ0JBQWdCLENBQUMs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cnQgKiBhcyBvcyBmcm9tICdvcyc7XG5cbi8qKlxuICogQSBsb2dnZXIgdGhhdCBsb2dzIG1lc3NhZ2VzIHRvIHRoZSBjb25zb2xlLlxuICovXG5leHBvcnQgY2xhc3MgTG9nZ2VyIHtcbiAgLy8gUHJvcGVydGllcyBmb3IgZWxsaXBzaXMgYW5pbWF0aW9uXG4gIHByaXZhdGUgdGltZXI6IFJldHVyblR5cGU8dHlwZW9mIHNldFRpbWVvdXQ+O1xuICBwcml2YXRlIHJlZnJlc2hSYXRlOiBudW1iZXI7XG4gIHByaXZhdGUgdGltZXJTZXQ6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgTG9nZ2VyIGluc3RhbmNlLiBJbmplY3Rpbmcgc3Rkb3V0IGZvciB0ZXN0aW5nLlxuICAgKiBAcGFyYW0gbWluaW11bUxvZ0xldmVsIFRoZSBtaW5pbXVtIGxvZyBsZXZlbCB0byBsb2cuXG4gICAqIEBwYXJhbSBzdGRvdXQgVGhlIHN0cmVhbSB0byB3cml0ZSBsb2dzIHRvLiBJbmplY3RlZCBmb3IgdGVzdGluZy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgbWluaW11bUxvZ0xldmVsOiBMb2dMZXZlbCA9IExvZ0xldmVsLklORk8sXG4gICAgcHJpdmF0ZSByZWFkb25seSBzdGRvdXQgPSBwcm9jZXNzLnN0ZG91dFxuICApIHtcbiAgICB0aGlzLnJlZnJlc2hSYXRlID0gNTAwOyAvLyBldmVyeSAwLjUgc2Vjb25kc1xuICB9XG5cbiAgLyoqXG4gICAqIExvZ3MgYSBtZXNzYWdlIHRvIHRoZSBjb25zb2xlLlxuICAgKi9cbiAgbG9nKG1lc3NhZ2U6IHN0cmluZywgbGV2ZWw6IExvZ0xldmVsID0gTG9nTGV2ZWwuSU5GTykge1xuICAgIGNvbnN0IHRvTG9nTWVzc2FnZSA9IGxldmVsIDw9IHRoaXMubWluaW11bUxvZ0xldmVsO1xuXG4gICAgaWYgKCF0b0xvZ01lc3NhZ2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBsb2dNZXNzYWdlID1cbiAgICAgIHRoaXMubWluaW11bUxvZ0xldmVsID09PSBMb2dMZXZlbC5ERUJVR1xuICAgICAgICA/IGBbJHtMb2dMZXZlbFtsZXZlbF19XSAke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKX06ICR7bWVzc2FnZX1gXG4gICAgICAgIDogbWVzc2FnZTtcbiAgICB0aGlzLnN0ZG91dC53cml0ZShsb2dNZXNzYWdlICsgb3MuRU9MKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2dzIGEgbWVzc2FnZSB3aXRoIGFuaW1hdGVkIGVsbGlwc2lzXG4gICAqL1xuICBhc3luYyBpbmRpY2F0ZVByb2dyZXNzKG1lc3NhZ2U6IHN0cmluZywgY2FsbGJhY2s6ICgpID0+IFByb21pc2U8dm9pZD4pIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5zdGFydEFuaW1hdGluZ0VsbGlwc2lzKG1lc3NhZ2UpO1xuICAgICAgYXdhaXQgY2FsbGJhY2soKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdGhpcy5zdG9wQW5pbWF0aW5nRWxsaXBzaXMobWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFdyaXRlcyBlc2NhcGUgc2VxdWVuY2UgdG8gc3Rkb3V0XG4gICAqL1xuICB3cml0ZUVzY2FwZVNlcXVlbmNlKGFjdGlvbjogRXNjYXBlU2VxdWVuY2UpIHtcbiAgICBpZiAoIXRoaXMuaXNUVFkoKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuc3Rkb3V0LndyaXRlKGFjdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIHRoZSBlbnZpcm9ubWVudCBpcyBUVFlcbiAgICovXG4gIGlzVFRZKCkge1xuICAgIHJldHVybiB0aGlzLnN0ZG91dC5pc1RUWTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2dzIGFuIGVycm9yIHRvIHRoZSBjb25zb2xlLlxuICAgKi9cbiAgZXJyb3IobWVzc2FnZTogc3RyaW5nKSB7XG4gICAgdGhpcy5sb2cobWVzc2FnZSwgTG9nTGV2ZWwuRVJST1IpO1xuICB9XG5cbiAgLyoqXG4gICAqIExvZ3MgYSB3YXJuaW5nIHRvIHRoZSBjb25zb2xlLlxuICAgKi9cbiAgd2FybihtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICB0aGlzLmxvZyhtZXNzYWdlLCBMb2dMZXZlbC5XQVJOSU5HKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2dzIGFuIGluZm8gbWVzc2FnZSB0byB0aGUgY29uc29sZS5cbiAgICovXG4gIGluZm8obWVzc2FnZTogc3RyaW5nKSB7XG4gICAgdGhpcy5sb2cobWVzc2FnZSwgTG9nTGV2ZWwuSU5GTyk7XG4gIH1cblxuICAvKipcbiAgICogTG9ncyBhIGRlYnVnIG1lc3NhZ2UgdG8gdGhlIGNvbnNvbGUuXG4gICAqL1xuICBkZWJ1ZyhtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICB0aGlzLmxvZyhtZXNzYWdlLCBMb2dMZXZlbC5ERUJVRyk7XG4gIH1cblxuICAvKipcbiAgICogU3RhcnQgYW5pbWF0aW5nIGVsbGlwc2lzIGF0IHRoZSBlbmQgb2YgYSBsb2cgbWVzc2FnZS5cbiAgICovXG4gIHByaXZhdGUgc3RhcnRBbmltYXRpbmdFbGxpcHNpcyhtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMuaXNUVFkoKSkge1xuICAgICAgdGhpcy5sb2cobWVzc2FnZSwgTG9nTGV2ZWwuSU5GTyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMudGltZXJTZXQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ1RpbWVyIGlzIGFscmVhZHkgc2V0IHRvIGFuaW1hdGUgZWxsaXBzaXMsIHN0b3AgdGhlIGN1cnJlbnQgcnVubmluZyB0aW1lciBiZWZvcmUgc3RhcnRpbmcgYSBuZXcgb25lLidcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgZnJhbWVMZW5ndGggPSA0OyAvLyBudW1iZXIgb2YgZGVzaXJlZCBkb3RzIC0gMVxuICAgIGxldCBmcmFtZUNvdW50ID0gMDtcbiAgICB0aGlzLnRpbWVyU2V0ID0gdHJ1ZTtcbiAgICB0aGlzLndyaXRlRXNjYXBlU2VxdWVuY2UoRXNjYXBlU2VxdWVuY2UuSElERV9DVVJTT1IpO1xuICAgIHRoaXMuc3Rkb3V0LndyaXRlKG1lc3NhZ2UpO1xuICAgIHRoaXMudGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICB0aGlzLndyaXRlRXNjYXBlU2VxdWVuY2UoRXNjYXBlU2VxdWVuY2UuQ0xFQVJfTElORSk7XG4gICAgICB0aGlzLndyaXRlRXNjYXBlU2VxdWVuY2UoRXNjYXBlU2VxdWVuY2UuTU9WRV9DVVJTT1JfVE9fU1RBUlQpO1xuICAgICAgdGhpcy5zdGRvdXQud3JpdGUobWVzc2FnZSArICcuJy5yZXBlYXQoKytmcmFtZUNvdW50ICUgZnJhbWVMZW5ndGgpKTtcbiAgICB9LCB0aGlzLnJlZnJlc2hSYXRlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9wcyBhbmltYXRpbmcgZWxsaXBzaXMgYW5kIHJlcGxhY2Ugd2l0aCBhIGxvZyBtZXNzYWdlLlxuICAgKi9cbiAgcHJpdmF0ZSBzdG9wQW5pbWF0aW5nRWxsaXBzaXMobWVzc2FnZTogc3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzLmlzVFRZKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjbGVhckludGVydmFsKHRoaXMudGltZXIpO1xuICAgIHRoaXMudGltZXJTZXQgPSBmYWxzZTtcbiAgICB0aGlzLndyaXRlRXNjYXBlU2VxdWVuY2UoRXNjYXBlU2VxdWVuY2UuQ0xFQVJfTElORSk7XG4gICAgdGhpcy53cml0ZUVzY2FwZVNlcXVlbmNlKEVzY2FwZVNlcXVlbmNlLk1PVkVfQ1VSU09SX1RPX1NUQVJUKTtcbiAgICB0aGlzLndyaXRlRXNjYXBlU2VxdWVuY2UoRXNjYXBlU2VxdWVuY2UuU0hPV19DVVJTT1IpO1xuICAgIHRoaXMuc3Rkb3V0LndyaXRlKGAke21lc3NhZ2V9Li4uJHtvcy5FT0x9YCk7XG4gIH1cbn1cblxuZW51bSBFc2NhcGVTZXF1ZW5jZSB7XG4gIENMRUFSX0xJTkUgPSAnXFx4MWJbMksnLFxuICBNT1ZFX0NVUlNPUl9UT19TVEFSVCA9ICdcXHgxYlswRycsXG4gIFNIT1dfQ1VSU09SID0gJ1xceDFiWz8yNWgnLFxuICBISURFX0NVUlNPUiA9ICdcXHgxYls/MjVsJyxcbn1cblxuZXhwb3J0IGVudW0gTG9nTGV2ZWwge1xuICBFUlJPUixcbiAgV0FSTklORyxcbiAgSU5GTyxcbiAgREVCVUcsXG59XG5cbmV4cG9ydCBjb25zdCBhcmd2ID0gYXdhaXQgeWFyZ3MocHJvY2Vzcy5hcmd2LnNsaWNlKDIpKS5vcHRpb25zKHtcbiAgZGVidWc6IHtcbiAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgZGVmYXVsdDogZmFsc2UsXG4gIH0sXG59KS5hcmd2O1xuXG5jb25zdCBtaW5pbXVtTG9nTGV2ZWwgPSBhcmd2LmRlYnVnID8gTG9nTGV2ZWwuREVCVUcgOiBMb2dMZXZlbC5JTkZPO1xuXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKG1pbmltdW1Mb2dMZXZlbCwgcHJvY2Vzcy5zdGRvdXQpO1xuXG5leHBvcnQgeyBsb2dnZXIgfTtcbiJdfQ==